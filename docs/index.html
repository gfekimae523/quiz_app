<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êó©Êäº„Åó„ÇØ„Ç§„Ç∫Â§ß‰ºö</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow: hidden;
        }

        /* „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ */
        #scoreboard {
            width: 300px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .score-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #4a5568;
        }

        .score-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex: 1;
        }

        .player-score {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 20px;
            border-radius: 15px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .player-score.rank-1 {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: #333;
            transform: scale(1.05);
            border: 3px solid #ff6b6b;
        }

        .player-score.rank-2 {
            background: linear-gradient(135deg, #c0c0c0, #a8a8a8);
            border: 2px solid #667eea;
        }

        .player-score.rank-3 {
            background: linear-gradient(135deg, #cd7f32, #b8860b);
            border: 1px solid #764ba2;
        }

        .player-score.current-player {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
        }

        .player-score.current-player.rank-1 {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: #333;
            border: 3px solid #ff6b6b;
        }

        .player-score.answered-correctly {
            animation: scoreIncrease 1s ease-in-out;
        }

        @keyframes scoreIncrease {
            0% { transform: scale(1); }
            50% { 
                transform: scale(1.2);
                background: linear-gradient(135deg, #2ed573, #1e90ff);
                box-shadow: 0 0 30px rgba(46, 213, 115, 0.6);
            }
            100% { transform: scale(1); }
        }

        .player-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-points {
            font-size: 30px;
            font-weight: bold;
        }

        .rank-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ff6b6b;
            color: white;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        .rank-indicator.rank-1 {
            background: #ffd700;
            color: #333;
        }

        .rank-indicator.rank-2 {
            background: #c0c0c0;
            color: #333;
        }

        .rank-indicator.rank-3 {
            background: #cd7f32;
            color: white;
        }

        /* ÂæóÁÇπ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .score-popup {
            position: fixed;
            font-size: 48px;
            font-weight: bold;
            color: #2ed573;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
            z-index: 2000;
            animation: scorePopup 2s ease-out forwards;
        }

        @keyframes scorePopup {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0.5);
            }
            20% {
                transform: translateY(-50px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) scale(1);
            }
        }

        /* „É°„Ç§„É≥Ë¶ÅÁ¥† */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            height: 100vh;
            box-sizing: border-box;
        }

        #playerSelect {
            margin-bottom: 40px;
            font-size: 20px;
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-width: 200px;
        }

        #pushButton {
            width: 350px;
            height: 350px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a0a0a0, #808080);
            color: white;
            border: none;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        #pushButton::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        #pushButton:hover::before {
            animation: shine 0.6s ease-in-out;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }

        #pushButton.enabled {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            box-shadow: 0 8px 30px rgba(76, 175, 80, 0.4);
        }

        #pushButton.enabled:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(76, 175, 80, 0.5);
        }

        #pushButton.disabled {
            cursor: not-allowed;
            background: linear-gradient(135deg, #666, #444);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #pushButton.pressed {
            cursor: not-allowed;
            animation: pulseGreen 1s infinite;
            transform: scale(0.95);
        }

        @keyframes pulseGreen {
            0% { 
                background: linear-gradient(135deg, #40FF40, #32cd32);
                box-shadow: 0 0 0 0 rgba(64, 255, 64, 0.7);
            }
            50% { 
                background: linear-gradient(135deg, #A0FFA0, #90ee90);
                box-shadow: 0 0 0 20px rgba(64, 255, 64, 0);
            }
            100% { 
                background: linear-gradient(135deg, #40FF40, #32cd32);
                box-shadow: 0 0 0 0 rgba(64, 255, 64, 0.7);
            }
        }

        #pushButton.incorrect {
            cursor: not-allowed;
            background: linear-gradient(135deg, #8080FF, #6060cc);
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        #pushButton.correct {
            cursor: not-allowed;
            animation: pulseRed 1s infinite;
            transform: scale(1.1);
        }

        @keyframes pulseRed {
            0% { 
                background: linear-gradient(135deg, #FF4040, #dc3545);
                box-shadow: 0 0 0 0 rgba(255, 64, 64, 0.7);
            }
            50% { 
                background: linear-gradient(135deg, #FF8080, #ff6b6b);
                box-shadow: 0 0 0 20px rgba(255, 64, 64, 0);
            }
            100% { 
                background: linear-gradient(135deg, #FF4040, #dc3545);
                box-shadow: 0 0 0 0 rgba(255, 64, 64, 0.7);
            }
        }

        #messageArea {
            margin-top: 40px;
            text-align: center;
            width: 100%;
            max-width: 500px;
            min-height: 40px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 15px 25px;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            #scoreboard {
                width: 100%;
                height: 200px;
                flex-direction: row;
                padding: 15px;
                overflow-x: auto;
            }

            .score-grid {
                flex-direction: row;
                min-width: max-content;
            }

            .player-score {
                min-width: 120px;
                padding: 15px;
            }

            .main-content {
                flex: 1;
                padding: 20px;
            }

            #pushButton {
                width: 250px;
                height: 250px;
                font-size: 22px;
            }

            .player-points {
                font-size: 28px;
            }

            .player-name {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ -->
    <div id="scoreboard">
        <div class="score-title">üèÜ ÂæóÁÇπÁä∂Ê≥Å üèÜ</div>
        <div id="scoreGrid" class="score-grid">
            <!-- „Éó„É¨„Ç§„É§„Éº„Çπ„Ç≥„Ç¢„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
        </div>
    </div>

    <div class="main-content">
        <select id="playerSelect">
            <option value="">„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû</option>
            <option value="Ë∂≥Á´ã">Ë∂≥Á´ã</option>
            <option value="Âä†Ëó§">Âä†Ëó§</option>
            <option value="ÂùÇ‰∫ï">ÂùÇ‰∫ï</option>
            <option value="ÂùÇ‰∏ã">ÂùÇ‰∏ã</option>
        </select>

        <button id="pushButton" class="enabled">PUSH</button>
        
        <div id="messageArea"></div>
    </div>

    <script>
        const serverUrl = 'https://quiz-app-8smm.onrender.com';
        let socket;
        let playerName = '';
        const pushButton = document.getElementById('pushButton');
        const playerSelect = document.getElementById('playerSelect');
        const messageArea = document.getElementById('messageArea');
        const scoreGrid = document.getElementById('scoreGrid');

        // Èü≥Â£∞„Éï„Ç°„Ç§„É´
        const pushSound = new Audio('push.mp3');
        const nextSound = new Audio('next.mp3');
        const correctSound = new Audio('correct.mp3');
        const incorrectSound = new Audio('incorrect.mp3');

        // „Éó„É¨„Ç§„É§„Éº„Çπ„Ç≥„Ç¢ÁÆ°ÁêÜ
        const playerScores = {
            'Ë∂≥Á´ã': 0,
            'Âä†Ëó§': 0,
            'ÂùÇ‰∫ï': 0,
            'ÂùÇ‰∏ã': 0
        };

        // ÂàùÊúü„Çπ„Ç≥„Ç¢„Éú„Éº„ÉâË°®Á§∫
        function initializeScoreboard() {
            Object.keys(playerScores).forEach(player => {
                updateScoreDisplay(player, 0);
            });
        }

        // „Çπ„Ç≥„Ç¢Ë°®Á§∫Êõ¥Êñ∞ÔºàÈ†Ü‰Ωç‰ªò„Åç„ÇΩ„Éº„ÉàÔºâ
        function updateScoreDisplay(player, score) {
            playerScores[player] = score;
            
            // „Çπ„Ç≥„Ç¢È†Ü„Å´„ÇΩ„Éº„ÉàÔºàÈôçÈ†ÜÔºâ
            const sortedPlayers = Object.entries(playerScores)
                .sort((a, b) => b[1] - a[1])
                .map(([name, score], index) => ({ name, score, rank: index + 1 }));

            // „Çπ„Ç≥„Ç¢„Ç∞„É™„ÉÉ„Éâ„Çí„ÇØ„É™„Ç¢
            scoreGrid.innerHTML = '';

            // „ÇΩ„Éº„ÉàÈ†Ü„ÅßË°®Á§∫
            sortedPlayers.forEach(({ name, score, rank }) => {
                const playerElement = document.createElement('div');
                playerElement.id = `score-${name}`;
                playerElement.className = 'player-score';
                
                // „É©„É≥„ÇØ„Å´Âøú„Åò„Åü„ÇØ„É©„ÇπËøΩÂä†
                if (rank === 1) playerElement.classList.add('rank-1');
                else if (rank === 2) playerElement.classList.add('rank-2');
                else if (rank === 3) playerElement.classList.add('rank-3');

                // ÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº„Çí„Éè„Ç§„É©„Ç§„Éà
                if (name === playerName) {
                    playerElement.classList.add('current-player');
                }

                playerElement.innerHTML = `
                    <div class="rank-indicator rank-${rank}">${rank}</div>
                    <div class="player-name">${name}</div>
                    <div class="player-points">${score}</div>
                `;

                scoreGrid.appendChild(playerElement);
            });
        }

        // ÂæóÁÇπ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ë°®Á§∫
        function showScoreAnimation(player, points) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${points}`;
            
            // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çπ„Ç≥„Ç¢„Éú„Éº„ÉâË¶ÅÁ¥†„ÅÆ‰ΩçÁΩÆ„ÇíÂèñÂæó
            const playerElement = document.getElementById(`score-${player}`);
            if (playerElement) {
                const rect = playerElement.getBoundingClientRect();
                popup.style.left = `${rect.left + rect.width / 2 - 25}px`;
                popup.style.top = `${rect.top + rect.height / 2}px`;
            } else {
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ‰ΩçÁΩÆ
                popup.style.left = '50%';
                popup.style.top = '50%';
                popup.style.transform = 'translateX(-50%)';
            }

            document.body.appendChild(popup);

            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Âæå„Å´Ë¶ÅÁ¥†„ÇíÂâäÈô§
            setTimeout(() => {
                if (document.body.contains(popup)) {
                    document.body.removeChild(popup);
                }
            }, 2000);
        }

        // „Éó„É¨„Ç§„É§„ÉºÈÅ∏Êäû„Ç§„Éô„É≥„Éà
        playerSelect.addEventListener('change', (e) => {
            playerName = e.target.value;
            if (playerName) {
                connectWebSocket();
                // ÂÖ®„Éó„É¨„Ç§„É§„Éº„ÅÆ„Çπ„Ç≥„Ç¢Ë°®Á§∫„ÇíÊõ¥Êñ∞
                Object.keys(playerScores).forEach(player => {
                    updateScoreDisplay(player, playerScores[player]);
                });
            }
        });

        // WebSocketÊé•Á∂ö
        function connectWebSocket() {
            socket = new WebSocket(`${serverUrl}/quiz`);

            socket.onopen = () => {
                console.log('WebSocketÊé•Á∂öÊàêÂäü');
                messageArea.textContent = '„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åó„Åæ„Åó„Åü';
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleServerMessage(data);
            };

            socket.onclose = () => {
                console.log('WebSocketÊé•Á∂öÂàáÊñ≠');
                messageArea.textContent = '„Çµ„Éº„Éê„Éº„Å®„ÅÆÊé•Á∂ö„ÅåÂàáÊñ≠„Åï„Çå„Åæ„Åó„Åü';
            };
        }

        // „Çµ„Éº„Éê„Éº„Åã„Çâ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Âá¶ÁêÜ
        function handleServerMessage(data) {
            switch(data.type) {
                case 'quizStart':
                    enablePushButton();
                    nextSound.play();
                    messageArea.textContent = 'ÂïèÈ°åÈñãÂßãÔºÅÊó©Êäº„Åó„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                    break;
                    
                case 'buttonPressed':
                    if (data.player === playerName) {
                        pressPushButton();
                        pushSound.play();
                        messageArea.textContent = 'ÂõûÁ≠îÊ®©„Ç≤„ÉÉ„ÉàÔºÅ';
                    } else {
                        if (pushButton.classList.contains('enabled')) {
                            disablePushButton();
                        }
                        messageArea.textContent = data.player + '„ÅåÊäº„Åó„Åæ„Åó„Åü';
                    }
                    break;
                    
                case 'correct':
                    if (data.player === playerName) {
                        setButtonCorrect();
                        correctSound.play();
                        messageArea.textContent = 'Ê≠£Ëß£ÔºÅ';
                    } else {
                        messageArea.textContent = data.player + '„ÅåÊ≠£Ëß£„Åó„Åæ„Åó„Åü';
                    }
                    
                    // „Çπ„Ç≥„Ç¢Êõ¥Êñ∞ÔºàÊ≠£Ëß£„Åß1ÁÇπËøΩÂä†Ôºâ
                    const newScore = playerScores[data.player] + 1;
                    updateScoreDisplay(data.player, newScore);
                    
                    // ÂæóÁÇπ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                    showScoreAnimation(data.player, 1);
                    
                    // „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ„ÅÆ„Éó„É¨„Ç§„É§„ÉºË¶ÅÁ¥†„Å´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ËøΩÂä†
                    const playerElement = document.getElementById(`score-${data.player}`);
                    if (playerElement) {
                        playerElement.classList.add('answered-correctly');
                        setTimeout(() => {
                            playerElement.classList.remove('answered-correctly');
                        }, 1000);
                    }
                    break;
                    
                case 'incorrect':
                    if (data.player === playerName) {
                        setButtonIncorrect();
                        incorrectSound.play();
                        messageArea.textContent = '‰∏çÊ≠£Ëß£...';
                    } else {
                        messageArea.textContent = data.player + '„Åå‰∏çÊ≠£Ëß£';
                    }
                    break;
                    
                case 'reset':
                    if (!data.disabledPlayers.includes(playerName)) {
                        enablePushButton();
                        messageArea.textContent = '‰ªñ„ÅÆ‰∫∫„ÇÇ„ÉÅ„É£„É¨„É≥„Ç∏„Åß„Åç„Åæ„Åô';
                    } else {
                        messageArea.textContent = '„Åì„ÅÆÂïèÈ°å„ÅØ„ÇÇ„ÅÜÂõûÁ≠î„Åß„Åç„Åæ„Åõ„Çì';
                    }
                    break;

                case 'scoreUpdate':
                    // „Çµ„Éº„Éê„Éº„Åã„Çâ„Çπ„Ç≥„Ç¢ÊÉÖÂ†±„ÅåÈÄÅ„Çâ„Çå„Å¶„Åç„ÅüÂ†¥Âêà„ÅÆÂá¶ÁêÜ
                    if (data.scores) {
                        Object.keys(data.scores).forEach(player => {
                            updateScoreDisplay(player, data.scores[player]);
                        });
                    }
                    break;
            }
        }

        // „Éú„Çø„É≥Êäº‰∏ã„Ç§„Éô„É≥„Éà
        pushButton.addEventListener('click', () => {
            push();
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                push();
            }
        });

        function push() {
            if (!playerName) {
                alert('ÂÖà„Å´„ÉÅ„Éº„É†„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            if (!pushButton.classList.contains('enabled')) {
                return;
            }

            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({
                    type: 'buttonPress',
                    player: playerName
                }));
            }
        }

        // „Éú„Çø„É≥Áä∂ÊÖãÂà∂Âæ°Èñ¢Êï∞
        function enablePushButton() {
            pushButton.disabled = false;
            pushButton.classList.remove(...pushButton.classList);
            pushButton.classList.add('enabled');
        }

        function disablePushButton() {
            pushButton.disabled = true;
            pushButton.classList.remove(...pushButton.classList);
            pushButton.classList.add('disabled');
        }

        function pressPushButton() {
            pushButton.disabled = true;
            pushButton.classList.remove(...pushButton.classList);
            pushButton.classList.add('pressed');
        }

        function setButtonCorrect() {
            pushButton.disabled = true;
            pushButton.classList.remove(...pushButton.classList);
            pushButton.classList.add('correct');
        }

        function setButtonIncorrect() {
            pushButton.disabled = true;
            pushButton.classList.remove(...pushButton.classList);
            pushButton.classList.add('incorrect');
        }

        // ÂàùÊúüÂåñ
        initializeScoreboard();
    </script>
</body>
</html>